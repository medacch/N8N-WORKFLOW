{"updatedAt":"2025-10-03T10:11:57.607Z","createdAt":"2025-10-03T10:11:57.607Z","id":"b7dXC36nsBHpezgV","name":"AI Concierge v0.1","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"ai-concierge-v3","responseMode":"responseNode","options":{}},"name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[112,-320],"id":"8b8744d4-926e-4565-91ac-f69c4efe6142","webhookId":"f3fb29ba-135b-4ac2-89be-f14e92a58a99","disabled":true},{"parameters":{"values":{"string":[{"name":"userMessage","value":"={{$json[\"body\"][\"message\"] || $json[\"message\"] || $json[\"text\"]}}"}]},"options":{}},"name":"Set Message","type":"n8n-nodes-base.set","typeVersion":1,"position":[336,-448],"id":"ddad99fe-4d59-4702-9461-93408a148f24"},{"parameters":{"respondWith":"json","responseBody":"{\n  \"output\": \"{{ $json.output }}\"\n}","options":{"responseCode":200}},"name":"Respond to Order","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2320,-544],"id":"4197db13-60ea-4627-b9cc-9b0f674e7e97"},{"parameters":{"promptType":"define","text":"={{ $json.Body }}","options":{"systemMessage":"=# Overview\nYou are a calendar assistant. Your responsibilities include:\n- Creating, getting, updating, and deleting events in the user's calendar.\n- Finding or suggesting appropriate titles for meetings or events.\n- Identifying available time slots by analyzing existing events.\n\nYou can reason over event data that has already been provided to you.  \nYou should **never say you cannot fulfill a request** if you have enough data to calculate or suggest something.\n\n---\n\n## Calendar Management Tools âœ¶âœ¶\n\n- **Create Event with Attendee** â†’ Use this when an event includes one or more participants.  \n- **Create Event** â†’ Use this for solo events.  \n- **Get Events** â†’ Fetch calendar schedules when requested, or when you need event data to reason about.  \n- **Update Event** â†’ To update an event, you must first use **Get Events** to obtain its ID.  \n- **Delete Event** â†’ To delete an event, you must first use **Get Events** to obtain its ID.  \n\nIf a duration for an event isnâ€™t specified, assume it will be **one hour**.\n\n---\n\n## Availability Reasoning\nIf you receive a list of events (with start and end times):\n- Sort them chronologically.\n- Determine the gaps between them.\n- Each gap represents a **free slot**.\n- Return your answer in **valid JSON** format.\n\nIf no events are provided, use the **Get Events** tool to fetch them first.  \nIf no free slots exist, return an empty list of available slots.\n\n## Final Notes \nHere is the current date/time: {{ $now }}\nUse this structure for responses:\n\n```json\n{\n  \"status\": \"success\",\n  \"available_slots\": [\n    { \"start\": \"2025-10-02T09:00\", \"end\": \"2025-10-02T10:30\" },\n    { \"start\": \"2025-10-02T12:00\", \"end\": \"2025-10-02T14:00\" }\n  ]\n}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1744,-464],"id":"af0511fb-4b7b-4d58-b8e2-631c2ad7dc12","name":"AI Agent"},{"parameters":{"calendar":{"__rl":true,"value":"purifyairashtrays@gmail.com","mode":"list","cachedResultName":"purifyairashtrays@gmail.com"},"start":"={{ $fromAI('Start', ``, 'string') }}","end":"={{ $fromAI('End', ``, 'string') }}","useDefaultReminders":"={{ $fromAI('Use_Default_Reminders', ``, 'boolean') }}","additionalFields":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2016,-16],"id":"0852af8b-7e9a-4404-8928-5d86e586540b","name":"Create an event in Google Calendar"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"purifyairashtrays@gmail.com","mode":"list","cachedResultName":"purifyairashtrays@gmail.com"},"limit":10,"timeMin":"={{ $today }}","timeMax":"={{ $now.plus({ day: 1 }) }}","options":{"timeZone":{"__rl":true,"value":"Africa/Casablanca","mode":"list","cachedResultName":"Africa/Casablanca"}}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2112,-16],"id":"96089339-6024-4d2f-8495-22a488dcc181","name":"Get many events in Google Calendar"},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}","mode":"id","__regex":"(^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*)"},"eventId":"={{ $fromAI('Event_ID', ``, 'string') }}","updateFields":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2208,-16],"id":"b8ba922c-01c9-4bc4-9481-269f8e7613fe","name":"Update an event in Google Calendar"},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}","mode":"id","__regex":"(^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*)"},"eventId":"={{ $fromAI('Event_ID', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2304,-32],"id":"a7ba1a89-1342-4f0d-b65d-0f6840cca625","name":"Delete an event in Google Calendar"},{"parameters":{"promptType":"define","text":"={{ $json.body }} or {{ $json.message.chat }}","messages":{"messageValues":[{"message":"=You are an Intent Classifier AI.  Your role is to analyze the userâ€™s message and decide which intent best matches their request.  You must classify the message into one of the following intents:  1. \"Order Status\" â†’ The user wants to know the status of their order (e.g. â€œWhere is my package?â€, â€œTrack my deliveryâ€, â€œCheck my orderâ€). 2. \"Schedule Call\" â†’ The user is frustrated, unhappy, or explicitly requests to speak to a human agent (e.g. â€œI want to talk to supportâ€, â€œCall meâ€, â€œThis is unacceptableâ€).  If the user expresses frustration, confusion, or dissatisfaction â€” even without clearly saying \"call\" â€” classify as **\"Schedule Call\"**.  If the message is unrelated, unclear, or missing details, default to **\"Schedule Call\"** (to ensure human support).  ---  ðŸŽ¯ **Your Task:** Return the intent in **strict JSON format** as shown below:  { \"intent\": \"Order Status\" }"}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[464,-448],"id":"6b7a354d-3b38-42b5-8168-2fd9562d92e8","name":"Basic LLM Chain"},{"parameters":{"promptType":"define","text":"={{ $json.Prompt }}","options":{"systemMessage":"You are an Order Status Assistant.  \nYour purpose is to help the user check the current status of their order.\n\nYou are connected to an order tracking system through n8n.  \nYou will receive information about the order (such as order_id, status, estimated_delivery_date) from previous nodes in the workflow.\n\n---\n\nðŸŽ¯ Your task:\n- Read the order details passed into this node.\n- Generate a friendly, professional message summarizing the orderâ€™s current status.\n- Always respond in **valid JSON format** compatible with the Respond to Webhook node.\n\n---\n\nðŸ“¦ The JSON you must return:\n\n```json\n{\n  \"status\": \"success\",\n  \"message\": \"Your order #12345 is currently out for delivery and should arrive on Oct 3rd.\"\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[592,-80],"id":"f726508a-c84f-436c-92c9-aa4433833749","name":"AI Agent1"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.output }}","options":{}},"name":"Respond to Order1","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[1296,-80],"id":"2602ee88-1399-493e-b61c-7f7f85c681f6"},{"parameters":{"assignments":{"assignments":[{"id":"3534dfd6-083a-47c5-8308-61c5487a3e02","name":"Body","value":"={{ $('Set Message').item.json.body }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1504,-464],"id":"ca2708ed-5bb4-4d8c-a585-8eda68e6a1fb","name":"Edit Fields"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.intent }}","rightValue":"=Schedule Call","operator":{"type":"string","operation":"equals"},"id":"2c124932-a451-462a-ab61-36573ccb9abf"}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"db0f5928-8026-409b-b7e5-897dcbb1d88c","leftValue":"={{ $json.intent }}","rightValue":"Order Status","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.3,"position":[1024,-448],"id":"2b50de25-0964-4e4e-9c4e-21a8a0891b4e","name":"Switch"},{"parameters":{"jsCode":"// Input example:\n// [\n//   {\n//     \"text\": \"```json\\n{\\n  \\\"intent\\\": \\\"Order Status\\\"\\n}\\n```\"\n//   }\n// ]\n\nreturn items.map(item => {\n  let raw = item.json.text || '';\n\n  // Remove ```json and ``` wrappers\n  raw = raw.replace(/```json\\s*/i, '').replace(/```/g, '').trim();\n\n  let parsed = {};\n  try {\n    parsed = JSON.parse(raw);\n  } catch (err) {\n    parsed = { intent: \"Schedule Call\" }; // fallback if parse fails\n  }\n\n  return {\n    json: parsed\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[816,-448],"id":"7298bd8c-b182-4f1e-9e8a-8d98ac3db35b","name":"Code in JavaScript"},{"parameters":{"assignments":{"assignments":[{"id":"639d0225-3f76-400c-8bb7-6559e02fabb9","name":"Prompt","value":"={{ $('Set Message').item.json.body }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1232,-352],"id":"a7340f2a-53b7-4388-939d-79b1a9792974","name":"Edit Fields1"},{"parameters":{"modelId":{"__rl":true,"value":"models/gemini-2.5-pro","mode":"list","cachedResultName":"models/gemini-2.5-pro"},"messages":{"values":[{"content":"=You are an expert front-end developer and UX designer.  \n\nI will give you a JSON object representing an order status like this:\n\n {{ $json.output }}"}]},"options":{"systemMessage":"You are an expert front-end developer and UX designer.   Your task is to convert this JSON into a beautiful, modern, and engaging HTML snippet suitable for embedding in a web page or email.  Requirements:  Highlight the status with a visual indicator (e.g., green for success, red for error, yellow for pending).  Display the message in a readable, engaging format.  Use UX-friendly elements such as cards, icons, badges, or progress bars.  Include responsive and clean styling using inline CSS (or style tags if necessary).  Make it visually appealing and easy to scan for users.  The HTML should be self-contained (no external libraries) and ready to render.  Output only the HTML code â€” do not include explanations or markdown wrappers.  output structure (feel free to enhance)"}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[944,-80],"id":"933feff3-ac5b-4426-8980-c6a28d0d068c","name":"Message a model"},{"parameters":{"updates":["message"],"additionalFields":{}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.2,"position":[144,-608],"id":"cd80d459-43e7-4231-95a6-dbb903d9193c","name":"Telegram Trigger","webhookId":"afffaa8e-0bd5-420c-84a8-6e502220d02a"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $json.output }}","replyMarkup":"forceReply","forceReply":{"force_reply":true},"additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[2304,-368],"id":"e2bf125c-2db4-44a4-8a22-a6e12e86a14b","name":"Send a text message","webhookId":"c0dc0b51-c8e0-4763-b7e2-4e2ee1daed30"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[400,-240],"id":"795d32b8-ed33-4963-8401-49d3cf431491","name":"Google Gemini Chat Model"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[464,128],"id":"3c05e413-d947-4519-b768-02ec10747068","name":"Google Gemini Chat Model1"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[1616,-256],"id":"e3db7d9d-bc53-49f4-8d8a-c494f5daa7ff","name":"Google Gemini Chat Model2"}],"connections":{"Webhook":{"main":[[{"node":"Set Message","type":"main","index":0}]]},"Set Message":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Send a text message","type":"main","index":0}]]},"Create an event in Google Calendar":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Get many events in Google Calendar":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Update an event in Google Calendar":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Delete an event in Google Calendar":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"Message a model","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[{"node":"Edit Fields1","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"Message a model":{"main":[[{"node":"Respond to Order1","type":"main","index":0}]]},"Telegram Trigger":{"main":[[{"node":"Set Message","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Google Gemini Chat Model2":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"dfbf8c65-480b-4877-aa48-4e8262b00779","triggerCount":0,"shared":[{"updatedAt":"2025-10-03T10:11:57.616Z","createdAt":"2025-10-03T10:11:57.616Z","role":"workflow:owner","workflowId":"b7dXC36nsBHpezgV","projectId":"EwgZBnPliNIepNcA"}],"tags":[]}